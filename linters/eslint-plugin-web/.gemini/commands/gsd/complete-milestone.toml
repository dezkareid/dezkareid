description = "Archive completed milestone and prepare for next version"
prompt = "<objective>\nMark milestone {{version}} complete, archive to milestones/, and update ROADMAP.md and REQUIREMENTS.md.\n\nPurpose: Create historical record of shipped version, archive milestone artifacts (roadmap + requirements), and prepare for next milestone.\nOutput: Milestone archived (roadmap + requirements), PROJECT.md evolved, git tagged.\n</objective>\n\n<execution_context>\n**Load these files NOW (before proceeding):**\n\n- @./.gemini/get-shit-done/workflows/complete-milestone.md (main workflow)\n- @./.gemini/get-shit-done/templates/milestone-archive.md (archive template)\n  </execution_context>\n\n<context>\n**Project files:**\n- `.planning/ROADMAP.md`\n- `.planning/REQUIREMENTS.md`\n- `.planning/STATE.md`\n- `.planning/PROJECT.md`\n\n**User input:**\n\n- Version: {{version}} (e.g., \"1.0\", \"1.1\", \"2.0\")\n  </context>\n\n<process>\n\n**Follow complete-milestone.md workflow:**\n\n0. **Check for audit:**\n\n   - Look for `.planning/v{{version}}-MILESTONE-AUDIT.md`\n   - If missing or stale: recommend `/gsd:audit-milestone` first\n   - If audit status is `gaps_found`: recommend `/gsd:plan-milestone-gaps` first\n   - If audit status is `passed`: proceed to step 1\n\n   ```markdown\n   ## Pre-flight Check\n\n   {If no v{{version}}-MILESTONE-AUDIT.md:}\n   ⚠ No milestone audit found. Run `/gsd:audit-milestone` first to verify\n   requirements coverage, cross-phase integration, and E2E flows.\n\n   {If audit has gaps:}\n   ⚠ Milestone audit found gaps. Run `/gsd:plan-milestone-gaps` to create\n   phases that close the gaps, or proceed anyway to accept as tech debt.\n\n   {If audit passed:}\n   ✓ Milestone audit passed. Proceeding with completion.\n   ```\n\n1. **Verify readiness:**\n\n   - Check all phases in milestone have completed plans (SUMMARY.md exists)\n   - Present milestone scope and stats\n   - Wait for confirmation\n\n2. **Gather stats:**\n\n   - Count phases, plans, tasks\n   - Calculate git range, file changes, LOC\n   - Extract timeline from git log\n   - Present summary, confirm\n\n3. **Extract accomplishments:**\n\n   - Read all phase SUMMARY.md files in milestone range\n   - Extract 4-6 key accomplishments\n   - Present for approval\n\n4. **Archive milestone:**\n\n   - Create `.planning/milestones/v{{version}}-ROADMAP.md`\n   - Extract full phase details from ROADMAP.md\n   - Fill milestone-archive.md template\n   - Update ROADMAP.md to one-line summary with link\n\n5. **Archive requirements:**\n\n   - Create `.planning/milestones/v{{version}}-REQUIREMENTS.md`\n   - Mark all v1 requirements as complete (checkboxes checked)\n   - Note requirement outcomes (validated, adjusted, dropped)\n   - Delete `.planning/REQUIREMENTS.md` (fresh one created for next milestone)\n\n6. **Update PROJECT.md:**\n\n   - Add \"Current State\" section with shipped version\n   - Add \"Next Milestone Goals\" section\n   - Archive previous content in `<details>` (if v1.1+)\n\n7. **Commit and tag:**\n\n   - Stage: MILESTONES.md, PROJECT.md, ROADMAP.md, STATE.md, archive files\n   - Commit: `chore: archive v{{version}} milestone`\n   - Tag: `git tag -a v{{version}} -m \"[milestone summary]\"`\n   - Ask about pushing tag\n\n8. **Offer next steps:**\n   - `/gsd:new-milestone` — start next milestone (questioning → research → requirements → roadmap)\n\n</process>\n\n<success_criteria>\n\n- Milestone archived to `.planning/milestones/v{{version}}-ROADMAP.md`\n- Requirements archived to `.planning/milestones/v{{version}}-REQUIREMENTS.md`\n- `.planning/REQUIREMENTS.md` deleted (fresh for next milestone)\n- ROADMAP.md collapsed to one-line entry\n- PROJECT.md updated with current state\n- Git tag v{{version}} created\n- Commit successful\n- User knows next steps (including need for fresh requirements)\n  </success_criteria>\n\n<critical_rules>\n\n- **Load workflow first:** Read complete-milestone.md before executing\n- **Verify completion:** All phases must have SUMMARY.md files\n- **User confirmation:** Wait for approval at verification gates\n- **Archive before deleting:** Always create archive files before updating/deleting originals\n- **One-line summary:** Collapsed milestone in ROADMAP.md should be single line with link\n- **Context efficiency:** Archive keeps ROADMAP.md and REQUIREMENTS.md constant size per milestone\n- **Fresh requirements:** Next milestone starts with `/gsd:new-milestone` which includes requirements definition\n  </critical_rules>"
