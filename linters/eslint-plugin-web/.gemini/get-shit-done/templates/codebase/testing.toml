prompt = "# Testing Patterns Template\n\nTemplate for `.planning/codebase/TESTING.md` - captures test framework and patterns.\n\n**Purpose:** Document how tests are written and run. Guide for adding tests that match existing patterns.\n\n---\n\n## File Template\n\n```markdown\n# Testing Patterns\n\n**Analysis Date:** [YYYY-MM-DD]\n\n## Test Framework\n\n**Runner:**\n- [Framework: e.g., \"Jest 29.x\", \"Vitest 1.x\"]\n- [Config: e.g., \"jest.config.js in project root\"]\n\n**Assertion Library:**\n- [Library: e.g., \"built-in expect\", \"chai\"]\n- [Matchers: e.g., \"toBe, toEqual, toThrow\"]\n\n**Run Commands:**\n```bash\n[e.g., \"npm test\" or \"npm run test\"]              # Run all tests\n[e.g., \"npm test -- --watch\"]                     # Watch mode\n[e.g., \"npm test -- path/to/file.test.ts\"]       # Single file\n[e.g., \"npm run test:coverage\"]                   # Coverage report\n```\n\n## Test File Organization\n\n**Location:**\n- [Pattern: e.g., \"*.test.ts alongside source files\"]\n- [Alternative: e.g., \"__tests__/ directory\" or \"separate tests/ tree\"]\n\n**Naming:**\n- [Unit tests: e.g., \"module-name.test.ts\"]\n- [Integration: e.g., \"feature-name.integration.test.ts\"]\n- [E2E: e.g., \"user-flow.e2e.test.ts\"]\n\n**Structure:**\n```\n[Show actual directory pattern, e.g.:\nsrc/\n  lib/\n    utils.ts\n    utils.test.ts\n  services/\n    user-service.ts\n    user-service.test.ts\n]\n```\n\n## Test Structure\n\n**Suite Organization:**\n```typescript\n[Show actual pattern used, e.g.:\n\ndescribe('ModuleName', () => {\n  describe('functionName', () => {\n    it('should handle success case', () => {\n      // arrange\n      // act\n      // assert\n    });\n\n    it('should handle error case', () => {\n      // test code\n    });\n  });\n});\n]\n```\n\n**Patterns:**\n- [Setup: e.g., \"beforeEach for shared setup, avoid beforeAll\"]\n- [Teardown: e.g., \"afterEach to clean up, restore mocks\"]\n- [Structure: e.g., \"arrange/act/assert pattern required\"]\n\n## Mocking\n\n**Framework:**\n- [Tool: e.g., \"Jest built-in mocking\", \"Vitest vi\", \"Sinon\"]\n- [Import mocking: e.g., \"vi.mock() at top of file\"]\n\n**Patterns:**\n```typescript\n[Show actual mocking pattern, e.g.:\n\n// Mock external dependency\nvi.mock('./external-service', () => ({\n  fetchData: vi.fn()\n}));\n\n// Mock in test\nconst mockFetch = vi.mocked(fetchData);\nmockFetch.mockResolvedValue({ data: 'test' });\n]\n```\n\n**What to Mock:**\n- [e.g., \"External APIs, file system, database\"]\n- [e.g., \"Time/dates (use vi.useFakeTimers)\"]\n- [e.g., \"Network calls (use mock fetch)\"]\n\n**What NOT to Mock:**\n- [e.g., \"Pure functions, utilities\"]\n- [e.g., \"Internal business logic\"]\n\n## Fixtures and Factories\n\n**Test Data:**\n```typescript\n[Show pattern for creating test data, e.g.:\n\n// Factory pattern\nfunction createTestUser(overrides?: Partial<User>): User {\n  return {\n    id: 'test-id',\n    name: 'Test User',\n    email: 'test@example.com',\n    ...overrides\n  };\n}\n\n// Fixture file\n// tests/fixtures/users.ts\nexport const mockUsers = [/* ... */];\n]\n```\n\n**Location:**\n- [e.g., \"tests/fixtures/ for shared fixtures\"]\n- [e.g., \"factory functions in test file or tests/factories/\"]\n\n## Coverage\n\n**Requirements:**\n- [Target: e.g., \"80% line coverage\", \"no specific target\"]\n- [Enforcement: e.g., \"CI blocks <80%\", \"coverage for awareness only\"]\n\n**Configuration:**\n- [Tool: e.g., \"built-in coverage via --coverage flag\"]\n- [Exclusions: e.g., \"exclude *.test.ts, config files\"]\n\n**View Coverage:**\n```bash\n[e.g., \"npm run test:coverage\"]\n[e.g., \"open coverage/index.html\"]\n```\n\n## Test Types\n\n**Unit Tests:**\n- [Scope: e.g., \"test single function/class in isolation\"]\n- [Mocking: e.g., \"mock all external dependencies\"]\n- [Speed: e.g., \"must run in <1s per test\"]\n\n**Integration Tests:**\n- [Scope: e.g., \"test multiple modules together\"]\n- [Mocking: e.g., \"mock external services, use real internal modules\"]\n- [Setup: e.g., \"use test database, seed data\"]\n\n**E2E Tests:**\n- [Framework: e.g., \"Playwright for E2E\"]\n- [Scope: e.g., \"test full user flows\"]\n- [Location: e.g., \"e2e/ directory separate from unit tests\"]\n\n## Common Patterns\n\n**Async Testing:**\n```typescript\n[Show pattern, e.g.:\n\nit('should handle async operation', async () => {\n  const result = await asyncFunction();\n  expect(result).toBe('expected');\n});\n]\n```\n\n**Error Testing:**\n```typescript\n[Show pattern, e.g.:\n\nit('should throw on invalid input', () => {\n  expect(() => functionCall()).toThrow('error message');\n});\n\n// Async error\nit('should reject on failure', async () => {\n  await expect(asyncCall()).rejects.toThrow('error message');\n});\n]\n```\n\n**Snapshot Testing:**\n- [Usage: e.g., \"for React components only\" or \"not used\"]\n- [Location: e.g., \"__snapshots__/ directory\"]\n\n---\n\n*Testing analysis: [date]*\n*Update when test patterns change*\n```\n\n<good_examples>\n```markdown\n# Testing Patterns\n\n**Analysis Date:** 2025-01-20\n\n## Test Framework\n\n**Runner:**\n- Vitest 1.0.4\n- Config: vitest.config.ts in project root\n\n**Assertion Library:**\n- Vitest built-in expect\n- Matchers: toBe, toEqual, toThrow, toMatchObject\n\n**Run Commands:**\n```bash\nnpm test                              # Run all tests\nnpm test -- --watch                   # Watch mode\nnpm test -- path/to/file.test.ts     # Single file\nnpm run test:coverage                 # Coverage report\n```\n\n## Test File Organization\n\n**Location:**\n- *.test.ts alongside source files\n- No separate tests/ directory\n\n**Naming:**\n- unit-name.test.ts for all tests\n- No distinction between unit/integration in filename\n\n**Structure:**\n```\nsrc/\n  lib/\n    parser.ts\n    parser.test.ts\n  services/\n    install-service.ts\n    install-service.test.ts\n  bin/\n    install.ts\n    (no test - integration tested via CLI)\n```\n\n## Test Structure\n\n**Suite Organization:**\n```typescript\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\n\ndescribe('ModuleName', () => {\n  describe('functionName', () => {\n    beforeEach(() => {\n      // reset state\n    });\n\n    it('should handle valid input', () => {\n      // arrange\n      const input = createTestInput();\n\n      // act\n      const result = functionName(input);\n\n      // assert\n      expect(result).toEqual(expectedOutput);\n    });\n\n    it('should throw on invalid input', () => {\n      expect(() => functionName(null)).toThrow('Invalid input');\n    });\n  });\n});\n```\n\n**Patterns:**\n- Use beforeEach for per-test setup, avoid beforeAll\n- Use afterEach to restore mocks: vi.restoreAllMocks()\n- Explicit arrange/act/assert comments in complex tests\n- One assertion focus per test (but multiple expects OK)\n\n## Mocking\n\n**Framework:**\n- Vitest built-in mocking (vi)\n- Module mocking via vi.mock() at top of test file\n\n**Patterns:**\n```typescript\nimport { vi } from 'vitest';\nimport { externalFunction } from './external';\n\n// Mock module\nvi.mock('./external', () => ({\n  externalFunction: vi.fn()\n}));\n\ndescribe('test suite', () => {\n  it('mocks function', () => {\n    const mockFn = vi.mocked(externalFunction);\n    mockFn.mockReturnValue('mocked result');\n\n    // test code using mocked function\n\n    expect(mockFn).toHaveBeenCalledWith('expected arg');\n  });\n});\n```\n\n**What to Mock:**\n- File system operations (fs-extra)\n- Child process execution (child_process.exec)\n- External API calls\n- Environment variables (process.env)\n\n**What NOT to Mock:**\n- Internal pure functions\n- Simple utilities (string manipulation, array helpers)\n- TypeScript types\n\n## Fixtures and Factories\n\n**Test Data:**\n```typescript\n// Factory functions in test file\nfunction createTestConfig(overrides?: Partial<Config>): Config {\n  return {\n    targetDir: '/tmp/test',\n    global: false,\n    ...overrides\n  };\n}\n\n// Shared fixtures in tests/fixtures/\n// tests/fixtures/sample-command.md\nexport const sampleCommand = `---\ndescription: Test command\n---\nContent here`;\n```\n\n**Location:**\n- Factory functions: define in test file near usage\n- Shared fixtures: tests/fixtures/ (for multi-file test data)\n- Mock data: inline in test when simple, factory when complex\n\n## Coverage\n\n**Requirements:**\n- No enforced coverage target\n- Coverage tracked for awareness\n- Focus on critical paths (parsers, service logic)\n\n**Configuration:**\n- Vitest coverage via c8 (built-in)\n- Excludes: *.test.ts, bin/install.ts, config files\n\n**View Coverage:**\n```bash\nnpm run test:coverage\nopen coverage/index.html\n```\n\n## Test Types\n\n**Unit Tests:**\n- Test single function in isolation\n- Mock all external dependencies (fs, child_process)\n- Fast: each test <100ms\n- Examples: parser.test.ts, validator.test.ts\n\n**Integration Tests:**\n- Test multiple modules together\n- Mock only external boundaries (file system, process)\n- Examples: install-service.test.ts (tests service + parser)\n\n**E2E Tests:**\n- Not currently used\n- CLI integration tested manually\n\n## Common Patterns\n\n**Async Testing:**\n```typescript\nit('should handle async operation', async () => {\n  const result = await asyncFunction();\n  expect(result).toBe('expected');\n});\n```\n\n**Error Testing:**\n```typescript\nit('should throw on invalid input', () => {\n  expect(() => parse(null)).toThrow('Cannot parse null');\n});\n\n// Async error\nit('should reject on file not found', async () => {\n  await expect(readConfig('invalid.txt')).rejects.toThrow('ENOENT');\n});\n```\n\n**File System Mocking:**\n```typescript\nimport { vi } from 'vitest';\nimport * as fs from 'fs-extra';\n\nvi.mock('fs-extra');\n\nit('mocks file system', () => {\n  vi.mocked(fs.readFile).mockResolvedValue('file content');\n  // test code\n});\n```\n\n**Snapshot Testing:**\n- Not used in this codebase\n- Prefer explicit assertions for clarity\n\n---\n\n*Testing analysis: 2025-01-20*\n*Update when test patterns change*\n```\n</good_examples>\n\n<guidelines>\n**What belongs in TESTING.md:**\n- Test framework and runner configuration\n- Test file location and naming patterns\n- Test structure (describe/it, beforeEach patterns)\n- Mocking approach and examples\n- Fixture/factory patterns\n- Coverage requirements\n- How to run tests (commands)\n- Common testing patterns in actual code\n\n**What does NOT belong here:**\n- Specific test cases (defer to actual test files)\n- Technology choices (that's STACK.md)\n- CI/CD setup (that's deployment docs)\n\n**When filling this template:**\n- Check package.json scripts for test commands\n- Find test config file (jest.config.js, vitest.config.ts)\n- Read 3-5 existing test files to identify patterns\n- Look for test utilities in tests/ or test-utils/\n- Check for coverage configuration\n- Document actual patterns used, not ideal patterns\n\n**Useful for phase planning when:**\n- Adding new features (write matching tests)\n- Refactoring (maintain test patterns)\n- Fixing bugs (add regression tests)\n- Understanding verification approach\n- Setting up test infrastructure\n\n**Analysis approach:**\n- Check package.json for test framework and scripts\n- Read test config file for coverage, setup\n- Examine test file organization (collocated vs separate)\n- Review 5 test files for patterns (mocking, structure, assertions)\n- Look for test utilities, fixtures, factories\n- Note any test types (unit, integration, e2e)\n- Document commands for running tests\n</guidelines>\n"
