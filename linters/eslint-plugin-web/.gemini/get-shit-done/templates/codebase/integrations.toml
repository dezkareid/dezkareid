prompt = "# External Integrations Template\n\nTemplate for `.planning/codebase/INTEGRATIONS.md` - captures external service dependencies.\n\n**Purpose:** Document what external systems this codebase communicates with. Focused on \"what lives outside our code that we depend on.\"\n\n---\n\n## File Template\n\n```markdown\n# External Integrations\n\n**Analysis Date:** [YYYY-MM-DD]\n\n## APIs & External Services\n\n**Payment Processing:**\n- [Service] - [What it's used for: e.g., \"subscription billing, one-time payments\"]\n  - SDK/Client: [e.g., \"stripe npm package v14.x\"]\n  - Auth: [e.g., \"API key in STRIPE_SECRET_KEY env var\"]\n  - Endpoints used: [e.g., \"checkout sessions, webhooks\"]\n\n**Email/SMS:**\n- [Service] - [What it's used for: e.g., \"transactional emails\"]\n  - SDK/Client: [e.g., \"sendgrid/mail v8.x\"]\n  - Auth: [e.g., \"API key in SENDGRID_API_KEY env var\"]\n  - Templates: [e.g., \"managed in SendGrid dashboard\"]\n\n**External APIs:**\n- [Service] - [What it's used for]\n  - Integration method: [e.g., \"REST API via fetch\", \"GraphQL client\"]\n  - Auth: [e.g., \"OAuth2 token in AUTH_TOKEN env var\"]\n  - Rate limits: [if applicable]\n\n## Data Storage\n\n**Databases:**\n- [Type/Provider] - [e.g., \"PostgreSQL on Supabase\"]\n  - Connection: [e.g., \"via DATABASE_URL env var\"]\n  - Client: [e.g., \"Prisma ORM v5.x\"]\n  - Migrations: [e.g., \"prisma migrate in migrations/\"]\n\n**File Storage:**\n- [Service] - [e.g., \"AWS S3 for user uploads\"]\n  - SDK/Client: [e.g., \"@aws-sdk/client-s3\"]\n  - Auth: [e.g., \"IAM credentials in AWS_* env vars\"]\n  - Buckets: [e.g., \"prod-uploads, dev-uploads\"]\n\n**Caching:**\n- [Service] - [e.g., \"Redis for session storage\"]\n  - Connection: [e.g., \"REDIS_URL env var\"]\n  - Client: [e.g., \"ioredis v5.x\"]\n\n## Authentication & Identity\n\n**Auth Provider:**\n- [Service] - [e.g., \"Supabase Auth\", \"Auth0\", \"custom JWT\"]\n  - Implementation: [e.g., \"Supabase client SDK\"]\n  - Token storage: [e.g., \"httpOnly cookies\", \"localStorage\"]\n  - Session management: [e.g., \"JWT refresh tokens\"]\n\n**OAuth Integrations:**\n- [Provider] - [e.g., \"Google OAuth for sign-in\"]\n  - Credentials: [e.g., \"GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET\"]\n  - Scopes: [e.g., \"email, profile\"]\n\n## Monitoring & Observability\n\n**Error Tracking:**\n- [Service] - [e.g., \"Sentry\"]\n  - DSN: [e.g., \"SENTRY_DSN env var\"]\n  - Release tracking: [e.g., \"via SENTRY_RELEASE\"]\n\n**Analytics:**\n- [Service] - [e.g., \"Mixpanel for product analytics\"]\n  - Token: [e.g., \"MIXPANEL_TOKEN env var\"]\n  - Events tracked: [e.g., \"user actions, page views\"]\n\n**Logs:**\n- [Service] - [e.g., \"CloudWatch\", \"Datadog\", \"none (stdout only)\"]\n  - Integration: [e.g., \"AWS Lambda built-in\"]\n\n## CI/CD & Deployment\n\n**Hosting:**\n- [Platform] - [e.g., \"Vercel\", \"AWS Lambda\", \"Docker on ECS\"]\n  - Deployment: [e.g., \"automatic on main branch push\"]\n  - Environment vars: [e.g., \"configured in Vercel dashboard\"]\n\n**CI Pipeline:**\n- [Service] - [e.g., \"GitHub Actions\"]\n  - Workflows: [e.g., \"test.yml, deploy.yml\"]\n  - Secrets: [e.g., \"stored in GitHub repo secrets\"]\n\n## Environment Configuration\n\n**Development:**\n- Required env vars: [List critical vars]\n- Secrets location: [e.g., \".env.local (gitignored)\", \"1Password vault\"]\n- Mock/stub services: [e.g., \"Stripe test mode\", \"local PostgreSQL\"]\n\n**Staging:**\n- Environment-specific differences: [e.g., \"uses staging Stripe account\"]\n- Data: [e.g., \"separate staging database\"]\n\n**Production:**\n- Secrets management: [e.g., \"Vercel environment variables\"]\n- Failover/redundancy: [e.g., \"multi-region DB replication\"]\n\n## Webhooks & Callbacks\n\n**Incoming:**\n- [Service] - [Endpoint: e.g., \"/api/webhooks/stripe\"]\n  - Verification: [e.g., \"signature validation via stripe.webhooks.constructEvent\"]\n  - Events: [e.g., \"payment_intent.succeeded, customer.subscription.updated\"]\n\n**Outgoing:**\n- [Service] - [What triggers it]\n  - Endpoint: [e.g., \"external CRM webhook on user signup\"]\n  - Retry logic: [if applicable]\n\n---\n\n*Integration audit: [date]*\n*Update when adding/removing external services*\n```\n\n<good_examples>\n```markdown\n# External Integrations\n\n**Analysis Date:** 2025-01-20\n\n## APIs & External Services\n\n**Payment Processing:**\n- Stripe - Subscription billing and one-time course payments\n  - SDK/Client: stripe npm package v14.8\n  - Auth: API key in STRIPE_SECRET_KEY env var\n  - Endpoints used: checkout sessions, customer portal, webhooks\n\n**Email/SMS:**\n- SendGrid - Transactional emails (receipts, password resets)\n  - SDK/Client: @sendgrid/mail v8.1\n  - Auth: API key in SENDGRID_API_KEY env var\n  - Templates: Managed in SendGrid dashboard (template IDs in code)\n\n**External APIs:**\n- OpenAI API - Course content generation\n  - Integration method: REST API via openai npm package v4.x\n  - Auth: Bearer token in OPENAI_API_KEY env var\n  - Rate limits: 3500 requests/min (tier 3)\n\n## Data Storage\n\n**Databases:**\n- PostgreSQL on Supabase - Primary data store\n  - Connection: via DATABASE_URL env var\n  - Client: Prisma ORM v5.8\n  - Migrations: prisma migrate in prisma/migrations/\n\n**File Storage:**\n- Supabase Storage - User uploads (profile images, course materials)\n  - SDK/Client: @supabase/supabase-js v2.x\n  - Auth: Service role key in SUPABASE_SERVICE_ROLE_KEY\n  - Buckets: avatars (public), course-materials (private)\n\n**Caching:**\n- None currently (all database queries, no Redis)\n\n## Authentication & Identity\n\n**Auth Provider:**\n- Supabase Auth - Email/password + OAuth\n  - Implementation: Supabase client SDK with server-side session management\n  - Token storage: httpOnly cookies via @supabase/ssr\n  - Session management: JWT refresh tokens handled by Supabase\n\n**OAuth Integrations:**\n- Google OAuth - Social sign-in\n  - Credentials: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET (Supabase dashboard)\n  - Scopes: email, profile\n\n## Monitoring & Observability\n\n**Error Tracking:**\n- Sentry - Server and client errors\n  - DSN: SENTRY_DSN env var\n  - Release tracking: Git commit SHA via SENTRY_RELEASE\n\n**Analytics:**\n- None (planned: Mixpanel)\n\n**Logs:**\n- Vercel logs - stdout/stderr only\n  - Retention: 7 days on Pro plan\n\n## CI/CD & Deployment\n\n**Hosting:**\n- Vercel - Next.js app hosting\n  - Deployment: Automatic on main branch push\n  - Environment vars: Configured in Vercel dashboard (synced to .env.example)\n\n**CI Pipeline:**\n- GitHub Actions - Tests and type checking\n  - Workflows: .github/workflows/ci.yml\n  - Secrets: None needed (public repo tests only)\n\n## Environment Configuration\n\n**Development:**\n- Required env vars: DATABASE_URL, NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY\n- Secrets location: .env.local (gitignored), team shared via 1Password vault\n- Mock/stub services: Stripe test mode, Supabase local dev project\n\n**Staging:**\n- Uses separate Supabase staging project\n- Stripe test mode\n- Same Vercel account, different environment\n\n**Production:**\n- Secrets management: Vercel environment variables\n- Database: Supabase production project with daily backups\n\n## Webhooks & Callbacks\n\n**Incoming:**\n- Stripe - /api/webhooks/stripe\n  - Verification: Signature validation via stripe.webhooks.constructEvent\n  - Events: payment_intent.succeeded, customer.subscription.updated, customer.subscription.deleted\n\n**Outgoing:**\n- None\n\n---\n\n*Integration audit: 2025-01-20*\n*Update when adding/removing external services*\n```\n</good_examples>\n\n<guidelines>\n**What belongs in INTEGRATIONS.md:**\n- External services the code communicates with\n- Authentication patterns (where secrets live, not the secrets themselves)\n- SDKs and client libraries used\n- Environment variable names (not values)\n- Webhook endpoints and verification methods\n- Database connection patterns\n- File storage locations\n- Monitoring and logging services\n\n**What does NOT belong here:**\n- Actual API keys or secrets (NEVER write these)\n- Internal architecture (that's ARCHITECTURE.md)\n- Code patterns (that's PATTERNS.md)\n- Technology choices (that's STACK.md)\n- Performance issues (that's CONCERNS.md)\n\n**When filling this template:**\n- Check .env.example or .env.template for required env vars\n- Look for SDK imports (stripe, @sendgrid/mail, etc.)\n- Check for webhook handlers in routes/endpoints\n- Note where secrets are managed (not the secrets)\n- Document environment-specific differences (dev/staging/prod)\n- Include auth patterns for each service\n\n**Useful for phase planning when:**\n- Adding new external service integrations\n- Debugging authentication issues\n- Understanding data flow outside the application\n- Setting up new environments\n- Auditing third-party dependencies\n- Planning for service outages or migrations\n\n**Security note:**\nDocument WHERE secrets live (env vars, Vercel dashboard, 1Password), never WHAT the secrets are.\n</guidelines>\n"
