prompt = "# Architecture Template\n\nTemplate for `.planning/codebase/ARCHITECTURE.md` - captures conceptual code organization.\n\n**Purpose:** Document how the code is organized at a conceptual level. Complements STRUCTURE.md (which shows physical file locations).\n\n---\n\n## File Template\n\n```markdown\n# Architecture\n\n**Analysis Date:** [YYYY-MM-DD]\n\n## Pattern Overview\n\n**Overall:** [Pattern name: e.g., \"Monolithic CLI\", \"Serverless API\", \"Full-stack MVC\"]\n\n**Key Characteristics:**\n- [Characteristic 1: e.g., \"Single executable\"]\n- [Characteristic 2: e.g., \"Stateless request handling\"]\n- [Characteristic 3: e.g., \"Event-driven\"]\n\n## Layers\n\n[Describe the conceptual layers and their responsibilities]\n\n**[Layer Name]:**\n- Purpose: [What this layer does]\n- Contains: [Types of code: e.g., \"route handlers\", \"business logic\"]\n- Depends on: [What it uses: e.g., \"data layer only\"]\n- Used by: [What uses it: e.g., \"API routes\"]\n\n**[Layer Name]:**\n- Purpose: [What this layer does]\n- Contains: [Types of code]\n- Depends on: [What it uses]\n- Used by: [What uses it]\n\n## Data Flow\n\n[Describe the typical request/execution lifecycle]\n\n**[Flow Name] (e.g., \"HTTP Request\", \"CLI Command\", \"Event Processing\"):**\n\n1. [Entry point: e.g., \"User runs command\"]\n2. [Processing step: e.g., \"Router matches path\"]\n3. [Processing step: e.g., \"Controller validates input\"]\n4. [Processing step: e.g., \"Service executes logic\"]\n5. [Output: e.g., \"Response returned\"]\n\n**State Management:**\n- [How state is handled: e.g., \"Stateless - no persistent state\", \"Database per request\", \"In-memory cache\"]\n\n## Key Abstractions\n\n[Core concepts/patterns used throughout the codebase]\n\n**[Abstraction Name]:**\n- Purpose: [What it represents]\n- Examples: [e.g., \"UserService, ProjectService\"]\n- Pattern: [e.g., \"Singleton\", \"Factory\", \"Repository\"]\n\n**[Abstraction Name]:**\n- Purpose: [What it represents]\n- Examples: [Concrete examples]\n- Pattern: [Pattern used]\n\n## Entry Points\n\n[Where execution begins]\n\n**[Entry Point]:**\n- Location: [Brief: e.g., \"src/index.ts\", \"API Gateway triggers\"]\n- Triggers: [What invokes it: e.g., \"CLI invocation\", \"HTTP request\"]\n- Responsibilities: [What it does: e.g., \"Parse args, route to command\"]\n\n## Error Handling\n\n**Strategy:** [How errors are handled: e.g., \"Exception bubbling to top-level handler\", \"Per-route error middleware\"]\n\n**Patterns:**\n- [Pattern: e.g., \"try/catch at controller level\"]\n- [Pattern: e.g., \"Error codes returned to user\"]\n\n## Cross-Cutting Concerns\n\n[Aspects that affect multiple layers]\n\n**Logging:**\n- [Approach: e.g., \"Winston logger, injected per-request\"]\n\n**Validation:**\n- [Approach: e.g., \"Zod schemas at API boundary\"]\n\n**Authentication:**\n- [Approach: e.g., \"JWT middleware on protected routes\"]\n\n---\n\n*Architecture analysis: [date]*\n*Update when major patterns change*\n```\n\n<good_examples>\n```markdown\n# Architecture\n\n**Analysis Date:** 2025-01-20\n\n## Pattern Overview\n\n**Overall:** CLI Application with Plugin System\n\n**Key Characteristics:**\n- Single executable with subcommands\n- Plugin-based extensibility\n- File-based state (no database)\n- Synchronous execution model\n\n## Layers\n\n**Command Layer:**\n- Purpose: Parse user input and route to appropriate handler\n- Contains: Command definitions, argument parsing, help text\n- Location: `src/commands/*.ts`\n- Depends on: Service layer for business logic\n- Used by: CLI entry point (`src/index.ts`)\n\n**Service Layer:**\n- Purpose: Core business logic\n- Contains: FileService, TemplateService, InstallService\n- Location: `src/services/*.ts`\n- Depends on: File system utilities, external tools\n- Used by: Command handlers\n\n**Utility Layer:**\n- Purpose: Shared helpers and abstractions\n- Contains: File I/O wrappers, path resolution, string formatting\n- Location: `src/utils/*.ts`\n- Depends on: Node.js built-ins only\n- Used by: Service layer\n\n## Data Flow\n\n**CLI Command Execution:**\n\n1. User runs: `gsd new-project`\n2. Commander parses args and flags\n3. Command handler invoked (`src/commands/new-project.ts`)\n4. Handler calls service methods (`src/services/project.ts` â†’ `create()`)\n5. Service reads templates, processes files, writes output\n6. Results logged to console\n7. Process exits with status code\n\n**State Management:**\n- File-based: All state lives in `.planning/` directory\n- No persistent in-memory state\n- Each command execution is independent\n\n## Key Abstractions\n\n**Service:**\n- Purpose: Encapsulate business logic for a domain\n- Examples: `src/services/file.ts`, `src/services/template.ts`, `src/services/project.ts`\n- Pattern: Singleton-like (imported as modules, not instantiated)\n\n**Command:**\n- Purpose: CLI command definition\n- Examples: `src/commands/new-project.ts`, `src/commands/plan-phase.ts`\n- Pattern: Commander.js command registration\n\n**Template:**\n- Purpose: Reusable document structures\n- Examples: PROJECT.md, PLAN.md templates\n- Pattern: Markdown files with substitution variables\n\n## Entry Points\n\n**CLI Entry:**\n- Location: `src/index.ts`\n- Triggers: User runs `gsd <command>`\n- Responsibilities: Register commands, parse args, display help\n\n**Commands:**\n- Location: `src/commands/*.ts`\n- Triggers: Matched command from CLI\n- Responsibilities: Validate input, call services, format output\n\n## Error Handling\n\n**Strategy:** Throw exceptions, catch at command level, log and exit\n\n**Patterns:**\n- Services throw Error with descriptive messages\n- Command handlers catch, log error to stderr, exit(1)\n- Validation errors shown before execution (fail fast)\n\n## Cross-Cutting Concerns\n\n**Logging:**\n- Console.log for normal output\n- Console.error for errors\n- Chalk for colored output\n\n**Validation:**\n- Zod schemas for config file parsing\n- Manual validation in command handlers\n- Fail fast on invalid input\n\n**File Operations:**\n- FileService abstraction over fs-extra\n- All paths validated before operations\n- Atomic writes (temp file + rename)\n\n---\n\n*Architecture analysis: 2025-01-20*\n*Update when major patterns change*\n```\n</good_examples>\n\n<guidelines>\n**What belongs in ARCHITECTURE.md:**\n- Overall architectural pattern (monolith, microservices, layered, etc.)\n- Conceptual layers and their relationships\n- Data flow / request lifecycle\n- Key abstractions and patterns\n- Entry points\n- Error handling strategy\n- Cross-cutting concerns (logging, auth, validation)\n\n**What does NOT belong here:**\n- Exhaustive file listings (that's STRUCTURE.md)\n- Technology choices (that's STACK.md)\n- Line-by-line code walkthrough (defer to code reading)\n- Implementation details of specific features\n\n**File paths ARE welcome:**\nInclude file paths as concrete examples of abstractions. Use backtick formatting: `src/services/user.ts`. This makes the architecture document actionable for Claude when planning.\n\n**When filling this template:**\n- Read main entry points (index, server, main)\n- Identify layers by reading imports/dependencies\n- Trace a typical request/command execution\n- Note recurring patterns (services, controllers, repositories)\n- Keep descriptions conceptual, not mechanical\n\n**Useful for phase planning when:**\n- Adding new features (where does it fit in the layers?)\n- Refactoring (understanding current patterns)\n- Identifying where to add code (which layer handles X?)\n- Understanding dependencies between components\n</guidelines>\n"
