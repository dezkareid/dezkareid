prompt = "<purpose>\nVerify milestone achieved its definition of done by aggregating phase verifications, checking cross-phase integration, and assessing requirements coverage. Reads existing VERIFICATION.md files (phases already verified during execute-phase), aggregates tech debt and deferred gaps, then spawns integration checker for cross-phase wiring.\n</purpose>\n\n<required_reading>\nRead all files referenced by the invoking prompt's execution_context before starting.\n</required_reading>\n\n<process>\n\n## 0. Initialize Milestone Context\n\n```bash\nINIT=$(node ./.gemini/get-shit-done/bin/gsd-tools.js init milestone-op)\n```\n\nExtract from init JSON: `milestone_version`, `milestone_name`, `phase_count`, `completed_phases`, `commit_docs`.\n\nResolve integration checker model:\n```bash\nCHECKER_MODEL=$(node ./.gemini/get-shit-done/bin/gsd-tools.js resolve-model gsd-integration-checker --raw)\n```\n\n## 1. Determine Milestone Scope\n\n```bash\n# Get phases in milestone (sorted numerically, handles decimals)\nnode ./.gemini/get-shit-done/bin/gsd-tools.js phases list\n```\n\n- Parse version from arguments or detect current from ROADMAP.md\n- Identify all phase directories in scope\n- Extract milestone definition of done from ROADMAP.md\n- Extract requirements mapped to this milestone from REQUIREMENTS.md\n\n## 2. Read All Phase Verifications\n\nFor each phase directory, read the VERIFICATION.md:\n\n```bash\ncat .planning/phases/01-*/*-VERIFICATION.md\ncat .planning/phases/02-*/*-VERIFICATION.md\n# etc.\n```\n\nFrom each VERIFICATION.md, extract:\n- **Status:** passed | gaps_found\n- **Critical gaps:** (if any — these are blockers)\n- **Non-critical gaps:** tech debt, deferred items, warnings\n- **Anti-patterns found:** TODOs, stubs, placeholders\n- **Requirements coverage:** which requirements satisfied/blocked\n\nIf a phase is missing VERIFICATION.md, flag it as \"unverified phase\" — this is a blocker.\n\n## 3. Spawn Integration Checker\n\nWith phase context collected:\n\n```\nTask(\n  prompt=\"Check cross-phase integration and E2E flows.\n\nPhases: {phase_dirs}\nPhase exports: {from SUMMARYs}\nAPI routes: {routes created}\n\nVerify cross-phase wiring and E2E user flows.\",\n  subagent_type=\"gsd-integration-checker\",\n  model=\"{integration_checker_model}\"\n)\n```\n\n## 4. Collect Results\n\nCombine:\n- Phase-level gaps and tech debt (from step 2)\n- Integration checker's report (wiring gaps, broken flows)\n\n## 5. Check Requirements Coverage\n\nFor each requirement in REQUIREMENTS.md mapped to this milestone:\n- Find owning phase\n- Check phase verification status\n- Determine: satisfied | partial | unsatisfied\n\n## 6. Aggregate into v{version}-MILESTONE-AUDIT.md\n\nCreate `.planning/v{version}-v{version}-MILESTONE-AUDIT.md` with:\n\n```yaml\n---\nmilestone: {version}\naudited: {timestamp}\nstatus: passed | gaps_found | tech_debt\nscores:\n  requirements: N/M\n  phases: N/M\n  integration: N/M\n  flows: N/M\ngaps:  # Critical blockers\n  requirements: [...]\n  integration: [...]\n  flows: [...]\ntech_debt:  # Non-critical, deferred\n  - phase: 01-auth\n    items:\n      - \"TODO: add rate limiting\"\n      - \"Warning: no password strength validation\"\n  - phase: 03-dashboard\n    items:\n      - \"Deferred: mobile responsive layout\"\n---\n```\n\nPlus full markdown report with tables for requirements, phases, integration, tech debt.\n\n**Status values:**\n- `passed` — all requirements met, no critical gaps, minimal tech debt\n- `gaps_found` — critical blockers exist\n- `tech_debt` — no blockers but accumulated deferred items need review\n\n## 7. Present Results\n\nRoute by status (see `<offer_next>`).\n\n</process>\n\n<offer_next>\nOutput this markdown directly (not as a code block). Route based on status:\n\n---\n\n**If passed:**\n\n## ✓ Milestone {version} — Audit Passed\n\n**Score:** {N}/{M} requirements satisfied\n**Report:** .planning/v{version}-MILESTONE-AUDIT.md\n\nAll requirements covered. Cross-phase integration verified. E2E flows complete.\n\n───────────────────────────────────────────────────────────────\n\n## ▶ Next Up\n\n**Complete milestone** — archive and tag\n\n/gsd:complete-milestone {version}\n\n*(/clear first → fresh context window)*\n\n───────────────────────────────────────────────────────────────\n\n---\n\n**If gaps_found:**\n\n## ⚠ Milestone {version} — Gaps Found\n\n**Score:** {N}/{M} requirements satisfied\n**Report:** .planning/v{version}-MILESTONE-AUDIT.md\n\n### Unsatisfied Requirements\n\n{For each unsatisfied requirement:}\n- **{REQ-ID}: {description}** (Phase {X})\n  - {reason}\n\n### Cross-Phase Issues\n\n{For each integration gap:}\n- **{from} → {to}:** {issue}\n\n### Broken Flows\n\n{For each flow gap:}\n- **{flow name}:** breaks at {step}\n\n───────────────────────────────────────────────────────────────\n\n## ▶ Next Up\n\n**Plan gap closure** — create phases to complete milestone\n\n/gsd:plan-milestone-gaps\n\n*(/clear first → fresh context window)*\n\n───────────────────────────────────────────────────────────────\n\n**Also available:**\n- cat .planning/v{version}-MILESTONE-AUDIT.md — see full report\n- /gsd:complete-milestone {version} — proceed anyway (accept tech debt)\n\n───────────────────────────────────────────────────────────────\n\n---\n\n**If tech_debt (no blockers but accumulated debt):**\n\n## ⚡ Milestone {version} — Tech Debt Review\n\n**Score:** {N}/{M} requirements satisfied\n**Report:** .planning/v{version}-MILESTONE-AUDIT.md\n\nAll requirements met. No critical blockers. Accumulated tech debt needs review.\n\n### Tech Debt by Phase\n\n{For each phase with debt:}\n**Phase {X}: {name}**\n- {item 1}\n- {item 2}\n\n### Total: {N} items across {M} phases\n\n───────────────────────────────────────────────────────────────\n\n## ▶ Options\n\n**A. Complete milestone** — accept debt, track in backlog\n\n/gsd:complete-milestone {version}\n\n**B. Plan cleanup phase** — address debt before completing\n\n/gsd:plan-milestone-gaps\n\n*(/clear first → fresh context window)*\n\n───────────────────────────────────────────────────────────────\n</offer_next>\n\n<success_criteria>\n- [ ] Milestone scope identified\n- [ ] All phase VERIFICATION.md files read\n- [ ] Tech debt and deferred gaps aggregated\n- [ ] Integration checker spawned for cross-phase wiring\n- [ ] v{version}-MILESTONE-AUDIT.md created\n- [ ] Results presented with actionable next steps\n</success_criteria>\n"
