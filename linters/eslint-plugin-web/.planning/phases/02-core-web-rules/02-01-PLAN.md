---
phase: 02-core-web-rules
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [tsconfig.json, package.json, src/index.ts]
autonomous: true

must_haves:
  truths:
    - "Package is built as CommonJS"
    - "tsconfig.json uses CommonJS module settings"
  artifacts:
    - path: "tsconfig.json"
      provides: "CJS compilation settings"
    - path: "package.json"
      provides: "CJS metadata and dependencies"
---

<objective>
Revert project to CommonJS and update dependencies.

Purpose: ESLint 9 plugins and @eslint/css compatibility.
Output: CJS-ready codebase.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-web-rules/02-CONTEXT.md
@.planning/phases/02-core-web-rules/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update tsconfig.json for CJS</name>
  <files>tsconfig.json</files>
  <action>
    Update `compilerOptions`:
    - Set `module` to `commonjs`
    - Set `moduleResolution` to `node`
    - Ensure `esModuleInterop` is `true`
  </action>
  <verify>grep "commonjs" tsconfig.json</verify>
  <done>tsconfig.json is configured for CJS</done>
</task>

<task type="auto">
  <name>Task 2: Update package.json and Entry Point</name>
  <files>package.json, src/index.ts</files>
  <action>
    - Ensure `type` is NOT `module` in package.json.
    - Add `@html-eslint/parser` and `@html-eslint/eslint-plugin` to devDependencies.
    - Change `src/index.ts` to use `module.exports = plugin` instead of `export default`.
  </action>
  <verify>Check exports in src/index.ts</verify>
  <done>Project structure is CJS-compatible</done>
</task>

</tasks>

<verification>
Run `npm run build` (if dependencies allow) or verify file contents.
</verification>

<success_criteria>
- [ ] tsconfig.json updated
- [ ] package.json updated
- [ ] src/index.ts uses module.exports
</success_criteria>
